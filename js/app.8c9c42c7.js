(function(e){function t(t){for(var a,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(p.length)p.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(a=!1)}a&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},i={app:0},r=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Player")],1)},r=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"player-wrapper flex-column"},[n("div",{staticClass:"player-header flex-row flex-middle flex-stretch"},[e._m(0),n("button",{staticClass:"btn-common",on:{click:function(t){e.isSearchOpen=!e.isSearchOpen}}},[n("i",{staticClass:"fa fa-bars"})])]),n("div",{staticClass:"player flex-row"},[n("div",{staticClass:"video flex-one"},[n("youtube",{ref:"youtube",attrs:{"video-id":e.videoId,"player-vars":e.playerVars},on:{ended:e.ended}})],1),n("div",{staticClass:"playlist flex-one"},[n("table",e._l(e.queue,(function(t,a){return n("tr",{key:a},[n("td",{staticClass:"number",class:{playing:0==a}},[e._v(" "+e._s(0==a?"Playing":a)+" ")]),n("td",[n("img",{attrs:{src:t.thumbnail}})]),n("td",[e._v(e._s(t.title))])])})),0)])]),n("div",{staticClass:"search",class:{visible:e.isSearchOpen}},[n("div",{staticClass:"search-bar flex-row"},[n("i",{staticClass:"fa fa-search"}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],staticClass:"search-input flex-one",attrs:{type:"text",placeholder:"Search video..."},domProps:{value:e.searchText},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.query(t)},input:function(t){t.target.composing||(e.searchText=t.target.value)}}}),n("button",{staticClass:"btn-common",on:{click:function(t){e.isSearchOpen=!1}}},[n("i",{staticClass:"fa fa-times-circle"})])]),n("ul",{staticClass:"results"},e._l(e.results.items,(function(t,a){return n("li",{key:a,staticClass:"video flex-row"},[n("div",{staticClass:"thumbnail"},[n("img",{attrs:{src:t.snippet.thumbnails.default.url},on:{click:function(n){return e.queueVideo(t)}}})]),n("div",{staticClass:"title"},[e._v(e._s(t.snippet.title))]),n("div",{staticClass:"duration"})])})),0)])])},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h2",{staticClass:"flex-one"},[n("i",{staticClass:"fa fa-headphones"}),e._v(" "),n("span",[e._v("DubPlayer")])])}],c=(n("d3b7"),n("25f0"),{get:function(e){var t="https://www.googleapis.com/youtube/v3/search?type=video&part=snippet&order=viewCount&maxResults=3&key=AIzaSyBQGdt4DU0NcwoBJvB5N6plDAXw85t2QfM";return a["a"].http.get("".concat(t,"&q=").concat(e))}}),l={connect:function(e){var t=this;this.drone=window._ScaleDrone,this.roomName="observable-"+e,this.drone.on("open",(function(e){if(e)return console.error(e);t.room=t.drone.subscribe(t.roomName),t.room.on("open",(function(e){if(e)return console.error(e);console.log("Connected to signaling server")})),t.room.on("members",(function(e){if(e.length>=3)return alert("The room is full");var n=2===e.length;t.startWebRTC(n)}))}))},sendSignalingMessage:function(e){this.drone.publish({room:this.roomName,message:e})},startWebRTC:function(e){var t=this;console.log("Starting WebRTC in as",e?"offerer":"waiter");var n={iceServers:[{url:"stun:stun.l.google.com:19302"}]};this.pc=new RTCPeerConnection(n),this.pc.onicecandidate=function(e){e.candidate&&t.sendSignalingMessage({candidate:e.candidate})},e?(this.pc.onnegotiationneeded=function(){t.pc.createOffer(t.localDescCreated,(function(e){return console.error(e)}))},this.dataChannel=this.pc.createDataChannel("chat"),this.setupDataChannel()):this.pc.ondatachannel=function(e){t.dataChannel=e.channel,t.setupDataChannel()},this.startListentingToSignals()},setupDataChannel:function(){this.checkDataChannelState(),this.dataChannel.onopen=this.checkDataChannelState,this.dataChannel.onclose=this.checkDataChannelState,this.dataChannel.onmessage=function(e){return console.log(JSON.parse(e.data),!1)}},checkDataChannelState:function(){console.log("WebRTC channel state is:",this.dataChannel.readyState),"open"===this.dataChannel.readyState&&console.log({content:"WebRTC data channel is now open"})},startListentingToSignals:function(){var e=this;this.room.on("data",(function(t,n){n.id!==e.drone.clientId&&(t.sdp?e.pc.setRemoteDescription(new RTCSessionDescription(t.sdp),(function(){console.log("pc.remoteDescription.type",e.pc.remoteDescription.type),"offer"===e.pc.remoteDescription.type&&(console.log("Answering offer"),e.pc.createAnswer(e.localDescCreated,(function(e){return console.error(e)})))}),(function(e){return console.error(e)})):t.candidate&&e.pc.addIceCandidate(new RTCIceCandidate(t.candidate)))}))},localDescCreated:function(e){var t=this;this.pc.setLocalDescription(e,(function(){return t.sendSignalingMessage({sdp:t.pc.localDescription})}),(function(e){return console.error(e)}))}},u={name:"Player",data:function(){return{queue:[],videoUrl:"",videoId:"",playerVars:{autoplay:1},isSearchOpen:!1,searchText:"",results:{}}},methods:{playVideo:function(){this.videoId=this.queue[0].id,this.player.playVideo()},queueVideo:function(e){var t={id:e.id.videoId,title:e.snippet.title,thumbnail:e.snippet.thumbnails.default.url};this.queue.push(t),l.sendSignalingMessage(JSON.stringify(t)),1==this.queue.length&&this.playVideo()},ended:function(){if(this.queue.shift(),this.queue.length>0){var e=this;setTimeout((function(){e.playVideo()}),2e3)}},query:function(){var e=this;c.get(this.searchText).then((function(t){e.results=t.data}))}},computed:{player:function(){return this.$refs.youtube.player}},mounted:function(){var e=Math.floor(16777215*Math.random()).toString(16);l.connect(e)}},d=u,p=(n("685d"),n("2877")),f=Object(p["a"])(d,o,s,!1,null,"d3d81ac0",null),h=f.exports,v={name:"app",components:{Player:h}},m=v,g=(n("5c0b"),Object(p["a"])(m,i,r,!1,null,null,null)),y=g.exports,b=n("e0ec"),C=n.n(b),w=n("28dd");a["a"].config.productionTip=!1,a["a"].use(w["a"]),a["a"].use(C.a),new a["a"]({render:function(e){return e(y)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var a=n("9c0c"),i=n.n(a);i.a},"685d":function(e,t,n){"use strict";var a=n("940b"),i=n.n(a);i.a},"940b":function(e,t,n){},"9c0c":function(e,t,n){}});
//# sourceMappingURL=app.8c9c42c7.js.map